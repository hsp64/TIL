# 25년 8월 19일


---


# 여행일지 사진/상세/목록 기능 


1. **여행일지 사진 조회 API**

* `TravelPhotoController`: `GET /api/photos/{travelLogId}`
* `TravelLogService.getPhotos(travelLogId)`: 사진 목록 조회 + 정렬
* `TravelPhotoResponseDto`: 응답 변환
* `TravelPhotoRepository.findByTravelLogOrderByDisplayOrderAsc`

2. **여행일지 상세 & 해시태그 조회**

* `TravelLogService.getTravelLogDetail(travelLogId)`
* `TravelLogService.getTagsByTravelLog(travelLogId)`
* `TravelLogTagRepository`(+ Custom/Impl)
* `TravelLogController`

  * `GET /api/travel-logs/{travelLogId}` (상세)
  * `GET /api/travel-logs/{travelLogId}/tags` (태그)
* `PageController`: `/travel-logs/detail` 라우트
* Frontend: `travel-log-detail.html/.js` (캐러셀/태그 렌더링)

3. **여행일지 목록 조회 API & DTO**

* `TravelLogService.getTravelLogsByTrip(userId, tripId, filters)`
* `TravelLogResponseDto` (coverImageUrl 포함)
* Frontend 연계 구조 준비(필터/검색)

4. **여행일지 목록 페이지 (UI/JS)**

* `travel-log-list.html/.js`: 필터, 검색, 페이지네이션, 상태관리
* `routes-config.js`: `/travel-logs` 경로 연결
* `PageController`: `/travel-logs` 페이지 연결

---

## 왜 이렇게 설계했나 (핵심 의사결정)

* **사진 정렬**: 사용자가 업로드 순서/썸네일 기준을 직관적으로 이해하도록 `displayOrder` 기반 정렬 API 제공.
* **N\:M(로그↔태그)**: 단순 다대다 대신 `TravelLogTag` 조인 엔티티를 사용해 중복 제거, 확장 속성(생성시각/정렬 등) 추가 여지 확보.
* **상세/태그 분리**: 상세 API는 본문/메타 위주, 태그 API는 독립 캐시/탭로딩을 고려해 별도 엔드포인트로 설계(지연 로딩 비용 분산).
* **대표 이미지(cover)**: 목록 성능을 위해 첫 사진 URL을 DTO에서 계산/캐싱(전면 썸네일 노출 최적화).

---

## API 스펙 요약 (백엔드)

### 1) 사진 조회

```
GET /api/photos/{travelLogId}
Response: 200 OK
[
  { "photoId": 1, "url": "/uploads/2025/08/img-001.jpg", "order": 0 },
  { "photoId": 2, "url": "/uploads/2025/08/img-002.jpg", "order": 1 }
]
```

* 정렬: `displayOrder ASC`
* 에러: 로그 미존재 404, 권한없음 403 (정책에 따라)

### 2) 여행일지 상세

```
GET /api/travel-logs/{travelLogId}
Response: 200 OK
{
  "id": 10,
  "title": "제주 2일차",
  "content": "협재-애월 드라이브",
  "mood": "HAPPY",
  "rating": 5,
  "expense": 32000,
  "createdAt": "2025-08-18T21:00:00",
  "coverImageUrl": "/uploads/2025/08/cover.jpg"
}
```

### 3) 여행일지 태그

```
GET /api/travel-logs/{travelLogId}/tags
Response: 200 OK
[
  { "id": 4, "name": "바다", "color": "#2E86DE", "category": "자연" },
  { "id": 7, "name": "카페", "color": "#A569BD", "category": "맛집" }
]
```

### 4) 여행일지 목록 (여행별)

```
GET /api/trips/{tripId}/logs?location=제주&logDate=2025-08-18&page=0&size=12
Response: 200 OK
{
  "content": [
    {
      "id": 10, "title": "제주 2일차", "mood": "HAPPY", "rating": 5,
      "coverImageUrl": "/uploads/2025/08/cover.jpg",
      "logDate": "2025-08-18"
    }
  ],
  "page": 0, "size": 12, "totalElements": 31
}
```

* 검색조건: `location`, \`logDate
