# 25년 8월 14일

---

# 여행일지 및 태그 관리 기능 개발

## 1. 여행일지 및 태그 관리 기능 추가

* **여행일지 기능 구현**

  * `TravelLog`, `TravelPhoto`, `TravelLogTag` 엔티티 설계 및 추가
  * 여행과 1\:N 관계 설정
  * 여행일지 작성/수정 관련 비즈니스 로직 구현
* **태그 관리 기능**

  * `Tag`, `TagCategory` 엔티티 설계 및 추가 (태그 분류, 색상 관리)
  * 태그와 여행일지의 다대다 관계(`TravelLogTag`) 매핑
* **레포지토리 생성**

  * `TravelLogRepository`: CRUD 및 통계 메서드
  * `TagRepository`: 태그 조회 및 카테고리 관리
  * `TravelPhotoRepository`: 사진 정렬 및 썸네일 제공
* **QueryDSL 적용**

  * `TravelLogRepositoryImpl`: 동적 검색 및 통계 처리 구현
* **에러 코드 업데이트**

  * 여행일지 및 태그 관련 예외 코드 추가

---

## 2. 여행일지 생성 기능 및 파일 업로드 설정

* **여행일지 작성 서비스 구현 (`TravelLogService.createTravelLog`)**

  * 사용자 및 여행 존재 여부 검증
  * 파일 첨부 기능 (최대 5개, 이미지 형식 검증)
  * 이미지 메타데이터 DB 저장 (`TravelPhoto`)
* **DTO 추가**

  * `TravelLogRequestDto`로 요청 데이터 구조화
  * 유효성 검증 메서드 포함
* **파일 업로드 환경 설정**

  * `application.yml`에 업로드 경로 지정
  * `FileUploadConfig.init`로 디렉토리 초기화
* **정적 리소스 제공**

  * `/uploads/**` 경로 접근 허용 (`WebResourceConfig`)

---

## 3. 여행일지 컨트롤러 및 API 구현

* **`TravelLogController`**

  * `POST /api/travel-logs` 여행일지 생성 API
  * `MultipartFile` 기반 파일 업로드 처리
  * 사용자 인증 정보(`@AuthenticationPrincipal`) 활용
* **기능 흐름**

  1. 여행 ID 및 요청 DTO 유효성 검증
  2. 첨부 파일 저장
  3. 서비스 호출 및 응답 반환

---

## 4. 디버깅 로그 추가 및 로직 개선

* **`TravelLogService`**

  * 사용자/여행 조회 로그 추가
  * 파일 업로드 과정별 로그 추가 (존재, 검증, 저장)
* **`TravelLogController`**

  * 첨부 파일명 출력 로그
* **`SecurityConfig`**

  * `/uploads/**` 정적 리소스 접근 허용

---

## 5. 여행일지 작성/수정 페이지 및 프론트엔드 기능

* **Frontend**

  * `travel-log-form.html`: 작성/수정 UI
  * `travel-log-form.js`: 작성, 태그 선택, 이미지 업로드, 드래그 앤 드롭 정렬
  * `/travel-logs/new` 경로 추가 (`routes-config.js`)
* **Backend**

  * `PageController`: `/travel-logs/new` 핸들러
  * `SecurityConfig`: `/travel-logs/**` 접근 허용
* **추가 기능**

  * 태그 입력, 기분 선택, 별점 평가, 지출 입력 지원

---

## 6. 프론트엔드 로직 개선 및 API 유틸리티 확장

* **Frontend 개선 (`travel-log-form.js`)**

  * 전역 상태 관리 객체(`state`) 추가
  * 이미지 썸네일 URL 변환 및 렌더링 개선
  * 이벤트 핸들러 구조화
  * 주석 강화
* **API 유틸리티 (`api.js`)**

  * FormData 요청 시 `Content-Type` 자동 설정
  * `postMultipart` 메서드 추가 (멀티파트 요청 지원)
  * 기본 헤더 설정 개선




* 태그, 별점, 기분, 지출 등 다양한 메타데이터를 여행일지에 통합하는 UX 설계

